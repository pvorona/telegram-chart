<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
</head>
<body>
  <!-- <script type="text/javascript" src="./data.js"></script> -->
  <style>
    body {
      margin: 0;
      padding: 40px;
      width: 100vw;
      height: 100vh;
    }

    .legend {
      position: absolute;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 480px;
    }

    .legend__item {
      position: absolute;
      color: #A4AAB0;
      font-size: 13px;
    }
  </style>
  <div class="legend">
    <div class="legend__item">1</div>
    <div class="legend__item">2</div>
    <div class="legend__item">3</div>
    <div class="legend__item">4</div>
    <div class="legend__item">5</div>
  </div>
  <canvas
    id="canvas"
    width="1024"
    height="480"
  ></canvas>
  <script>
    const LEGEND_FONT_SIZE = 13
    const LEGEND_PADDING = 5
    const LIMIT = 100000
    data1 = [10, 8, 15, 13, 5, 8, 9, 4]
    // data1 = data.slice(0, 60)
    data2 = [7, 5, 9, 13, 18, 21, 24, 20]
    // data2 = data.slice(LIMIT, LIMIT + 60)

    // const path = {
    //   points, color,
    // }


    const context = canvas.getContext('2d')
    const geometry = {
      width: canvas.width,
      height: canvas.height,
    }
    render([
      { data: data1, color: '#FF684D' },
      { data: data2, color: '#47B44D' },
    ])

    function render (input) {
      console.time('render')
      const max = findMaxValue([...input[0].data, ...input[1].data])
      renderLattice(5)
      renderVerticalLegend(max, 5)
      renderPaths(input, max)
      console.timeEnd('render')
    }

    // O(n)
    function findMaxValue (data) {
      const max = Math.max(...data)
      if (max % 10 === 0) return max
      if (max % 5 === 0) return max
      return max + (5 - max % 5)
    }

    // O(1)
    function renderLattice (numberOfLines) {
      const screenStep = geometry.height / numberOfLines
      const legendItems = [...document.querySelectorAll('.legend__item')]

      context.strokeStyle = '#F5F5F5'
      for (let i = 0; i < numberOfLines; i++) {
        context.beginPath();
        context.moveTo(0, geometry.height - screenStep * i - 1);
        context.lineTo(geometry.width, geometry.height - screenStep * i - 1)
        context.stroke();
      }
    }

    function renderVerticalLegend (max,numberOfLines) {
      const valueStep = max / numberOfLines
      const screenStep = geometry.height / numberOfLines
      const legendItems = [...document.querySelectorAll('.legend__item')]

      for (let i = 0; i < numberOfLines; i++) {
        legendItems[i].innerText = valueStep * i
        legendItems[i].style = `top: ${geometry.height - screenStep * i - 1 - LEGEND_FONT_SIZE - LEGEND_PADDING}px;`
      }
    }

    // O(n) + O(n)
    function renderPaths (input, max) {
      for (const { data, color } of input) {
        const points = mapDataToCoords(data, max)
        renderPath({ points, color })
      }
    }

    // O(n)
    function mapDataToCoords (data, max) {
      const coords = []
      for (let i = 0; i < data.length; i++) {
        coords.push({
          x: geometry.width / (data.length - 1) * i,
          y: geometry.height - geometry.height / max * data[i],
        })
      }
      return coords
    }

    function renderPath ({ points, color }) {
      context.beginPath();
      context.strokeStyle = color

      for (const { x, y } of points) {
        context.lineTo(x, y);
      }

      context.stroke();
    }
  </script>
</body>
</html>